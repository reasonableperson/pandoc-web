// Generated by CoffeeScript 1.6.3
(function() {
  angular.module('pandoc.controllers', ['ui.codemirror', 'LocalStorageModule', 'ngSanitize']).controller('pandoc-web', [
    '$scope', '$element', 'localStorageService', '$sanitize', '$location', function(scope, elem, storage, $sanitize, location) {
      scope.location = location;
      scope.documents = storage.get('documents');
      if (scope.documents == null) {
        console.log('no documents found');
        scope.documents = [
          {
            name: 'example',
            markdown: '# Markdown view'
          }
        ];
        storage.add('documents', scope.documents);
      } else {
        console.log(scope.documents.length + ' documents found.');
      }
      scope.doc = scope.documents[0];
      return console.log('current doc', scope.doc);
    }
  ]).service('showdown', function() {
    var converter, html, source;
    html = '';
    source = '';
    converter = new Showdown.converter();
    return {
      convert: function(markdown) {
        source = markdown;
        return html = converter.makeHtml(markdown);
      },
      html: function() {
        return html;
      },
      source: function() {
        return source;
      }
    };
  }).controller('markdown', [
    '$scope', '$element', 'localStorageService', '$sanitize', '$location', 'showdown', function(scope, elem, storage, $sanitize, location, showdown) {
      scope.cmOptions = {
        mode: 'markdown',
        theme: 'solarized',
        onChange: function() {
          return showdown.convert(scope.doc.markdown);
        }
      };
      scope.cmOptions.onChange();
      scope.save = function() {
        scope.doc.lastSaved = new Date();
        return storage.add('documents', scope.documents);
      };
      scope.render = function() {
        return console.log(scope.doc);
      };
      return scope["new"] = function() {
        return scope.documents.push({
          name: scope.newDoc,
          markdown: "Add content to your new document..."
        });
      };
    }
  ]).controller('html', [
    '$scope', 'showdown', function(scope, showdown) {
      return scope.showdown = showdown;
    }
  ]).controller('pdf', [
    '$scope', '$http', 'showdown', function(scope, http, showdown) {
      console.log('pdf controller');
      scope.url = 'tmp/a62315ff07c69bdb9e9e58ea6d32a759.pdf';
      return scope.renderPdf = function() {
        console.log('rendering...');
        return http.post('render/pdf', {
          markdown: showdown.source()
        }).success(function(data, status, headers, config) {
          console.log(data);
          return scope.url = 'tmp/' + data + '.pdf';
        }).error(function(data, status, headers, config) {
          return console.log(data);
        });
      };
    }
  ]);

}).call(this);
