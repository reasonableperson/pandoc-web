// Generated by CoffeeScript 1.6.3
(function() {
  angular.module('pandoc.controllers', ['ui.codemirror', 'LocalStorageModule', 'ngSanitize', 'pandoc.services']).controller('pandoc-web', [
    '$scope', '$element', 'localStorageService', '$sanitize', '$location', function(scope, elem, storage, $sanitize, location) {
      scope.location = location;
      scope.documents = storage.get('documents');
      if (scope.documents == null) {
        console.log('no documents found');
        scope.documents = [
          {
            name: 'example',
            markdown: '# Markdown view'
          }
        ];
        storage.add('documents', scope.documents);
      } else {
        console.log(scope.documents.length + ' documents found.');
      }
      scope.doc = scope.documents[0];
      return console.log('current doc', scope.doc);
    }
  ]).controller('markdown', [
    '$scope', '$element', 'localStorageService', '$sanitize', '$location', 'pandocument', function(scope, elem, storage, $sanitize, location, pandocument) {
      scope.cmOptions = {
        mode: 'markdown',
        theme: 'solarized',
        onChange: function() {
          return pandocument.convert(scope.doc.markdown);
        }
      };
      scope.cmOptions.onChange();
      scope.save = function() {
        scope.doc.lastSaved = new Date();
        return storage.add('documents', scope.documents);
      };
      scope.render = function() {
        return console.log(scope.doc);
      };
      return scope["new"] = function() {
        return scope.documents.push({
          name: scope.newDoc,
          markdown: "Add content to your new document..."
        });
      };
    }
  ]).controller('html', [
    '$scope', 'pandocument', function(scope, pandocument) {
      return scope.pandocument = pandocument;
    }
  ]).controller('pdf', [
    '$scope', '$http', 'pandocument', function(scope, http, pandocument) {
      console.log('pdf controller');
      scope.url = 'tmp/a62315ff07c69bdb9e9e58ea6d32a759.pdf';
      return scope.renderPdf = function() {
        console.log('rendering...');
        return http.post('render/pdf', {
          markdown: pandocument.source()
        }).success(function(data, status, headers, config) {
          console.log(data);
          return scope.url = 'tmp/' + data + '.pdf';
        }).error(function(data, status, headers, config) {
          return console.log(data);
        });
      };
    }
  ]);

}).call(this);
